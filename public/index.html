<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#110A27" />
  <meta name="description" content="Zen Pipeline - Облачные сборки для iOS и macOS" />
  <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />

  <title>Zen Pipeline - Облачные сборки для iOS и macOS</title>
  <!-- Top.Mail.Ru counter -->
  <script type="text/javascript">
    var _tmr = window._tmr || (window._tmr = []);
    _tmr.push({ id: "3659683", type: "pageView", start: (new Date()).getTime() });
    (function (d, w, id) {
      if (d.getElementById(id)) return;
      var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true; ts.id = id;
      ts.src = "https://top-fwz1.mail.ru/js/code.js";
      var f = function () { var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s); };
      if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
    })(document, window, "tmr-code");
  </script>
  <noscript>
    <div><img src="https://top-fwz1.mail.ru/counter?id=3659683;js=na" style="position:absolute;left:-9999px;"
        alt="Top.Mail.Ru" /></div>
  </noscript>
  <!-- /Top.Mail.Ru counter -->

  
  <!-- WebP поддержка и оптимизация -->
  <script>
    // Определение поддержки WebP
    function supportsWebP() {
      return new Promise((resolve) => {
        const webP = new Image();
        webP.onload = webP.onerror = () => {
          resolve(webP.height === 2);
        };
        webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
      });
    }

    // Добавляем класс для CSS
    supportsWebP().then(supported => {
      document.documentElement.classList.add(supported ? 'webp' : 'no-webp');
    });

    // Улучшенный lazy loading для изображений и picture элементов
    function lazyLoadImages() {
      const lazyImages = document.querySelectorAll('img[data-src]');
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              
              // Обрабатываем picture элемент если он есть
              const picture = img.closest('picture');
              if (picture) {
                // Загружаем все source элементы
                const sources = picture.querySelectorAll('source[data-srcset]');
                sources.forEach(source => {
                  source.srcset = source.dataset.srcset;
                  source.removeAttribute('data-srcset');
                });
              }
              
              // Загружаем img элемент
              if (img.dataset.src) {
                img.src = img.dataset.src;
                img.classList.add('loaded');
                img.removeAttribute('data-src');
              }
              
              imageObserver.unobserve(img);
            }
          });
        }, {
          rootMargin: '50px' // Загружаем изображения за 50px до появления в viewport
        });
        
        lazyImages.forEach(img => imageObserver.observe(img));
      } else {
        // Fallback для старых браузеров
        lazyImages.forEach(img => {
          const picture = img.closest('picture');
          if (picture) {
            const sources = picture.querySelectorAll('source[data-srcset]');
            sources.forEach(source => {
              source.srcset = source.dataset.srcset;
            });
          }
          
          if (img.dataset.src) {
            img.src = img.dataset.src;
            img.classList.add('loaded');
          }
        });
      }
    }

    // Запускаем после загрузки DOM
    document.addEventListener('DOMContentLoaded', lazyLoadImages);
  </script>
</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root"></div>
</body>

</html>